<div class="dashboard-layout">
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <mat-icon color="primary">flight_takeoff</mat-icon>
            <h2>Travel Admin</h2>
        </div>

        <nav class="nav-menu">
            <div class="nav-item" [class.active]="currentView === 'browse'" (click)="currentView = 'browse'">
                <mat-icon>public</mat-icon>
                <span>Browse Countries</span>
            </div>
            <div class="nav-item" [class.active]="currentView === 'manage'" (click)="currentView = 'manage'">
                <mat-icon>settings_suggest</mat-icon>
                <span>Manage System</span>
            </div>
        </nav>

        <div class="logout-btn">
            <div class="nav-item" (click)="logout()">
                <mat-icon>logout</mat-icon>
                <span>Sign Out</span>
            </div>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Progress Bar for Bulk Operations -->
        <div class="progress-container" *ngIf="isSaving || isDeleting">
            <div class="progress-info">
                <span>{{ isSaving ? 'Adding' : 'Deleting' }} Destinations...</span>
                <span>{{ progressValue }}%</span>
            </div>
            <mat-progress-bar mode="determinate" [value]="progressValue"></mat-progress-bar>
        </div>

        <!-- View: Browse Countries -->
        <ng-container *ngIf="currentView === 'browse'">
            <header class="page-header">
                <div class="header-title">
                    <h1>Global Explorer</h1>
                    <p>Discover new destinations to add to your platform</p>
                </div>
                <button mat-flat-button color="primary" [disabled]="selection.selected.length === 0 || isSaving"
                    (click)="bulkAdd()">
                    <mat-icon *ngIf="!isSaving">add_circle</mat-icon>
                    <mat-spinner diameter="20" *ngIf="isSaving"></mat-spinner>
                    Add Selected ({{selection.selected.length}})
                </button>
            </header>

            <div class="glass-card">
                <div class="search-bar">
                    <input type="text" class="fancy-input" placeholder="Search countries by name..."
                        (input)="onExternalSearch($event)">
                </div>

                <div class="table-wrapper mat-elevation-z0">
                    <table mat-table [dataSource]="suggestionsDataSource">
                        <ng-container matColumnDef="select">
                            <th mat-header-cell *matHeaderCellDef>
                                <mat-checkbox (change)="$event ? masterToggleSuggestions() : null"
                                    [checked]="selection.hasValue() && isAllSuggestionsSelected()"
                                    [indeterminate]="selection.hasValue() && !isAllSuggestionsSelected()">
                                </mat-checkbox>
                            </th>
                            <td mat-cell *matCellDef="let row">
                                <mat-checkbox (click)="$event.stopPropagation()"
                                    (change)="$event ? selection.toggle(row) : null"
                                    [checked]="selection.isSelected(row)">
                                </mat-checkbox>
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="flagUrl">
                            <th mat-header-cell *matHeaderCellDef> Flag </th>
                            <td mat-cell *matCellDef="let element">
                                <img [src]="element.flagUrl" class="flag-thumb">
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="country">
                            <th mat-header-cell *matHeaderCellDef> Name </th>
                            <td mat-cell *matCellDef="let element" style="font-weight: 600;"> {{element.country}} </td>
                        </ng-container>

                        <ng-container matColumnDef="capital">
                            <th mat-header-cell *matHeaderCellDef> Capital </th>
                            <td mat-cell *matCellDef="let element">
                                <span class="badge">{{element.capital}}</span>
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="currency">
                            <th mat-header-cell *matHeaderCellDef> Currency </th>
                            <td mat-cell *matCellDef="let element">
                                <span class="badge">{{element.currency}}</span>
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="population">
                            <th mat-header-cell *matHeaderCellDef> Population </th>
                            <td mat-cell *matCellDef="let element"> {{element.population | number}} </td>
                        </ng-container>

                        <tr mat-header-row *matHeaderRowDef="suggestionColumns"></tr>
                        <tr mat-row *matRowDef="let row; columns: suggestionColumns;" (click)="selection.toggle(row)"
                            [class.selected-row]="selection.isSelected(row)">
                        </tr>
                    </table>

                    <mat-paginator #suggestionsPaginator [pageSize]="10" [pageSizeOptions]="[5, 10, 25]">
                    </mat-paginator>

                    <div *ngIf="isFetchingSuggestions" class="loading-overlay">
                        <mat-spinner diameter="40"></mat-spinner>
                        <p>Scanning the Globe...</p>
                    </div>
                </div>
            </div>
        </ng-container>

        <!-- View: Manage System -->
        <ng-container *ngIf="currentView === 'manage'">
            <header class="page-header">
                <div class="header-title">
                    <h1>Resource Inventory</h1>
                    <p>Edit or remove destinations from your local database</p>
                </div>
                <button mat-flat-button color="warn" [disabled]="internalSelection.selected.length === 0 || isDeleting"
                    (click)="bulkDelete()">
                    <mat-icon *ngIf="!isDeleting">delete_sweep</mat-icon>
                    <mat-spinner diameter="20" *ngIf="isDeleting"></mat-spinner>
                    Delete Selected ({{internalSelection.selected.length}})
                </button>
            </header>

            <div class="glass-card">
                <div class="search-bar">
                    <input type="text" class="fancy-input" placeholder="Filter integrated countries..."
                        (keyup)="applySearch($event)">
                </div>

                <div class="table-wrapper mat-elevation-z0">
                    <table mat-table [dataSource]="internalDataSource">
                        <ng-container matColumnDef="select">
                            <th mat-header-cell *matHeaderCellDef>
                                <mat-checkbox (change)="$event ? masterToggleInternal() : null"
                                    [checked]="internalSelection.hasValue() && isAllInternalSelected()"
                                    [indeterminate]="internalSelection.hasValue() && !isAllInternalSelected()">
                                </mat-checkbox>
                            </th>
                            <td mat-cell *matCellDef="let row">
                                <mat-checkbox (click)="$event.stopPropagation()"
                                    (change)="$event ? internalSelection.toggle(row) : null"
                                    [checked]="internalSelection.isSelected(row)">
                                </mat-checkbox>
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="flagUrl">
                            <th mat-header-cell *matHeaderCellDef> Flag </th>
                            <td mat-cell *matCellDef="let element">
                                <img [src]="element.flagUrl" class="flag-thumb">
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="country">
                            <th mat-header-cell *matHeaderCellDef> Country </th>
                            <td mat-cell *matCellDef="let element" style="font-weight: 600;"> {{element.country}} </td>
                        </ng-container>

                        <ng-container matColumnDef="capital">
                            <th mat-header-cell *matHeaderCellDef> Capital </th>
                            <td mat-cell *matCellDef="let element"> {{element.capital}} </td>
                        </ng-container>

                        <ng-container matColumnDef="currency">
                            <th mat-header-cell *matHeaderCellDef> Currency </th>
                            <td mat-cell *matCellDef="let element"> {{element.currency}} </td>
                        </ng-container>

                        <ng-container matColumnDef="population">
                            <th mat-header-cell *matHeaderCellDef> Population </th>
                            <td mat-cell *matCellDef="let element"> {{element.population | number}} </td>
                        </ng-container>

                        <tr mat-header-row *matHeaderRowDef="internalColumns"></tr>
                        <tr mat-row *matRowDef="let row; columns: internalColumns;"
                            (click)="internalSelection.toggle(row)"></tr>
                    </table>
                    <mat-paginator [length]="totalItems" [pageSize]="pageSize" [pageSizeOptions]="[5, 10, 25]"
                        (page)="onPageChange($event)">
                    </mat-paginator>
                </div>
            </div>
        </ng-container>
    </main>
</div>